Prompt 
You are an expert Machine Learning engineer. You project is to identify root causes of low machine utilization and OEE of plant. You are given 5 target variables to analyze: Downtime (Hrs), Uptime, FPY %, Wound %, and OEE Availability. The data is daily average data where the date is in the column named 'GMT Prod Yield Date'. A column named Merge contains product type on that day. It also contains codes for shutdowns which may be planned for mainetnance or unplanned due to machine reliability. The data contains process and raw material variables which are daily averaged. Note that there may be 2 to 7 days lag in the actual process of when the raw materials actually hits the machine. So you would need to account for that. The material variables are X11, X12, X13, X14 , X15, X17, X24, X38 to X44. Out of these variables X14 and X17 are string variables.



There is a pre-step in the process which takes 8-16 hours to complete, so the variables associated with the pre step can occassionably be lagged by a day as well. The pre-step variables are X5, X6, X7, X8, X18, X19, X25, X26, X28, X29, X34, X35, X36.



Besides these there are process variables associated with machine. These are labeled from X1 to X33 excluding the ones described above. All numeric and non-numeric variables have some missing values scattered across the entire dataset



Your first task is to identify shifts in target variables. The operations expect that there would like to see it by each product type in Merge. They believe that the product shifts may be leading to the low machine utilization. Create a comprehensive plan on how you will tackle the analysis. Also create a code to first programtically identify and analyze when the shifts are happening. Suggest what you would use for this step with reasons. Previous analysis have used methods like Cumsum plots to identify.



Next step is to correlate the shifts to process, raw material and pre-step variable changes. Provide the complete steps including the code on how you would perform the analysis






Analysis Plan: A Step-by-Step Approach
This project requires a systematic approach to untangle the complex interactions between raw materials, pre-step processes, machine operations, and the final output metrics.

Step 1: Data Cleaning and Preprocessing üßπ
The quality of our analysis hinges on clean, well-structured data.

Handling Missing Values:

Numerical Variables: For scattered missing data in process variables, we'll use an imputation method like k-Nearest Neighbors (k-NN) imputer. This is superior to simple mean/median imputation because it uses the values of neighboring data points to estimate the missing value, preserving the data's underlying structure.

Categorical Variables: For the string variables (X14, X17), we will impute missing values with a placeholder like "Unknown" or use the mode (most frequent value).

Data Type Conversion: Ensure the GMT Prod Yield Date is converted to a proper datetime object to enable time-based analysis and sorting.

Categorical Encoding: The string variables (X14, X17, and Merge after separating shutdown codes) will be converted into a numerical format using one-hot encoding so they can be used in correlation and modeling steps later.

Step 2: Shift Detection with Change Point Detection (CPD) üìà
Your operations team is right to suspect that shifts in product type are impacting performance. While CUSUM plots are a valid tool, a more powerful and automated method is Change Point Detection (CPD).

Why CPD? I recommend using the Pruned Exact Linear Time (PELT) algorithm.

Accuracy: PELT is an exact algorithm, meaning it finds the optimal segmentation of the data, unlike heuristic methods.

Automation: It can programmatically detect multiple change points without requiring manual threshold setting.

Robustness: It's less susceptible to noise compared to simpler methods like CUSUM.

Execution:

Group the dataset by the Merge column (product type).

For each product type, and for each of the five target variables, apply the PELT algorithm to the time series.

This will give us the specific dates where the statistical properties (like the mean) of the target variable changed significantly.

Visualize these change points by plotting the target variable over time and drawing vertical lines at the detected shift dates.

Step 3: Feature Engineering for Time Lags ‚è≥
To accurately correlate inputs to outputs, we must account for the described time delays.

Raw Material Lag: For each material variable (X11, X12, etc.), we will create multiple new lagged features. For example, for X11, we'll create X11_lag2, X11_lag3, ..., X11_lag7. This means the value for a given day will be matched with the output from 2 to 7 days in the future.

Pre-Step Lag: Similarly, for the pre-step variables (X5, X6, etc.), we will create a _lag1 version of each to account for the 8-16 hour processing time which can push its impact to the next day.

Step 4: Root Cause Analysis: Correlating Shifts with Variables üîó
Once we know when the shifts happened, we can investigate why.

Segment Analysis: We'll analyze the periods between the detected change points. For each segment, we will calculate the average value of all process, lagged raw material, and lagged pre-step variables.

Statistical Correlation: We will perform statistical tests (e.g., ANOVA or t-tests) to see if there is a statistically significant difference in the input variables between the "before shift" and "after shift" periods.

Feature Importance Modeling: To handle complex interactions, we will build a predictive model (like Gradient Boosting or Random Forest) for each target variable. The model's "feature importance" output will rank every process and material variable by its influence on the target. This is a powerful technique for identifying the most likely root causes, even when relationships are not simple linear correlations.

Code: Identifying Target Variable Shifts
Here is the Python code to perform the first major step of our plan: using Change Point Detection to identify and visualize shifts in your key metrics for each product type. I've included detailed comments to explain each part of the process.
OEE Shift Detection Analysis
Aug 4, 9:26 AM

 Try again without Canvas 

Next Steps & Conclusion
This initial analysis will provide you with a set of critical dates where performance shifted for each product. These plots are the foundation for the next phase of our investigation.

With these change points identified, the immediate next step is to execute Step 3 (Feature Engineering) and Step 4 (Root Cause Analysis) from the plan. We will create the lagged variables and then compare the process and material data from the periods before and after each change point. This will allow us to move from what changed to why it changed, ultimately identifying the levers you can pull to improve machine utilization and OEE.
